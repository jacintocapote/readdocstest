

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Updating and Maintaining DKAN &mdash; DKAN 1.13 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="DKAN 1.13 documentation" href="../index.html"/>
        <link rel="up" title="DKAN Overview" href="index.html"/>
        <link rel="next" title="Major Components" href="../components/index.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> DKAN
          

          
          </a>

          
            
            
              <div class="version">
                1.13
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">DKAN Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="about.html">About this documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="catalog-basics.html">Catalog Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="dkan-ckan.html">Comparing DKAN and CKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="get-dkan.html">Get DKAN</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Updating and Maintaining DKAN</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#filesystem-conventions">Filesystem Conventions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#primary-maintenance-tasks">Primary Maintenance Tasks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#getting-dkan-updates">Getting DKAN Updates</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#basic-upgrades">Basic Upgrades</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-drush-make">Using drush make</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#features-module">Features Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-workflows">Advanced Workflows</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-a-custom-make-file">Using a Custom Make file</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-additional-modules-or-features">Adding additional modules or features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#overriding-current-dkan-modules-or-functionality">Overriding current DKAN modules or functionality</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Major Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Extending and Customizing DKAN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apis/index.html">API Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Releases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">DKAN</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">DKAN Overview</a> &raquo;</li>
      
    <li>Updating and Maintaining DKAN</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/introduction/maintaining.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="updating-and-maintaining-dkan">
<h1>Updating and Maintaining DKAN<a class="headerlink" href="#updating-and-maintaining-dkan" title="Permalink to this headline">¶</a></h1>
<p>There are several strategies for maintaining your DKAN site. Maintaining
a DKAN site does not differ substantially from <a class="reference external" href="https://www.drupal.org/documentation/build/distributions">maintaining other Drupal
distributions</a>.</p>
<p>Drupal distributions consist of a script that runs at the time of the
installation as well as a set of modules, themes, and libraries that
exist at <code class="docutils literal"><span class="pre">profiles/MY_DISTRIBUTION</span></code> directory. These modules, themes,
and libraries work the same as any other modules, themes, or libraries
that are added to Drupal sites. They are packaged together in the
<code class="docutils literal"><span class="pre">profiles</span></code> directory to make it easier to install and maintain.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last"><a class="reference external" href="https://github.com/NuCivic/dkan-starter">DKAN Starter</a> is project
containing a prebuilt version of DKAN and the tools <a class="reference external" href="https://www.granicus.com/">Granicus</a> uses for our own implementations and
deployments. Learn more advanced workflows in that project&#8217;s
<a class="reference external" href="https://dkan-starter.readthedocs.io">documentation</a>.</p>
</div>
<div class="section" id="filesystem-conventions">
<h2>Filesystem Conventions<a class="headerlink" href="#filesystem-conventions" title="Permalink to this headline">¶</a></h2>
<p>With Drupal&#8217;s inheritance model mentioned above, it should not be
necessary to place custom code or modules in the <code class="docutils literal"><span class="pre">profiles/dkan</span></code>
directory. Additional modules, themes, or libraries, or newer versions
of ones already present in <code class="docutils literal"><span class="pre">profiles/dkan</span></code>, can be placed in
<code class="docutils literal"><span class="pre">sites/all</span></code>.</p>
<p>If it is necessary or expedient to overwrite files in the
<code class="docutils literal"><span class="pre">profiles/dkan</span></code> directory, it is recommended to keep a
<a class="reference external" href="https://ariejan.net/2009/10/26/how-to-create-and-apply-a-patch-with-git/">patch</a>
of the changes. A patch will make it possible to re-apply changes once a
newer version of DKAN is added to the &#8216;profiles/dkan&#8217; directory.</p>
<p>If DKAN&#8217;s extensions and customizations of core Drupal are isolated in
<code class="docutils literal"><span class="pre">profiles/DKAN</span></code>, and your site&#8217;s particular configuration, files, and
overrides and customizations of DKAN are isolated in <code class="docutils literal"><span class="pre">sites/</span></code>,
maintaining your DKAN site will be much easier.</p>
</div>
<div class="section" id="primary-maintenance-tasks">
<h2>Primary Maintenance Tasks<a class="headerlink" href="#primary-maintenance-tasks" title="Permalink to this headline">¶</a></h2>
<p>By &#8220;maintenance&#8221; we mean three specific tasks</p>
<ul class="simple">
<li><strong>Upgrading</strong> DKAN to receive new features and bug-fixes</li>
<li><strong>Adding</strong> additional modules or features</li>
<li><strong>Overriding</strong> current modules or functionally</li>
</ul>
</div>
<div class="section" id="getting-dkan-updates">
<h2>Getting DKAN Updates<a class="headerlink" href="#getting-dkan-updates" title="Permalink to this headline">¶</a></h2>
<p>DKAN uses Drupal versioning standards, with one modification. <em>Minor</em>
upgrades to DKAN are released approximately every 4-6 weeks. For
instance, a minor release would move from DKAN 7.x-1.11 to 7.x-1.12.
Starting with version 7.x-1.12, we are adding <em>patch</em> releases for
security and bug fixes. For instance, the first patch release between
7.x-1.12 and 7.x-1.13 will be 7.x-1.12.1.</p>
<p>Please note <em>you can not use</em> <code class="docutils literal"><span class="pre">drush</span> <span class="pre">up</span></code> <em>with DKAN</em>. This is because
DKAN is not packaged on Drupal.org.</p>
<div class="section" id="basic-upgrades">
<h3>Basic Upgrades<a class="headerlink" href="#basic-upgrades" title="Permalink to this headline">¶</a></h3>
<p>The least complex way to update your DKAN codebase is similar to <a class="reference external" href="https://www.drupal.org/node/1494290">an
update of Drupal itself</a>.</p>
<ol class="arabic simple">
<li>Back up your database (just in case!)</li>
<li>Copy your <code class="docutils literal"><span class="pre">sites</span></code> folder somewhere safe.</li>
<li>Replace your entire codebase with the latest fully built version of
DKAN from <a class="reference external" href="https://github.com/NuCivic/dkan-drops-7">DKAN DROPS-7</a>.</li>
<li>Check the new versions&#8217; <a class="reference external" href="https://github.com/NuCivic/dkan/releases">release
notes</a> to see if there
are any special instructions for updating. (If you are several
releases behind, you may need to follow instructions for several
releases).</li>
<li>Replace the <code class="docutils literal"><span class="pre">sites</span></code> folder in your new codebase with your old
<code class="docutils literal"><span class="pre">sites</span></code> folder.</li>
<li>Now navigate to <em>http://yoursite.com/update.php</em> or run
<code class="docutils literal"><span class="pre">drush</span> <span class="pre">updatedb</span></code>.</li>
<li>Clear caches by visiting <em>/admin/performance</em> or running
<code class="docutils literal"><span class="pre">drush</span> <span class="pre">cache-clear</span> <span class="pre">all</span></code>.</li>
<li>Revert all features by visiting <em>/admin/structure/features</em> or
running <code class="docutils literal"><span class="pre">drush</span> <span class="pre">features-revert-all</span></code> (Use with caution, as this may
overwrite any DKAN configuration you have overridden and not exported
to code; see <a class="reference external" href="https://www.drupal.org/project/features">Features</a>
for more information.)</li>
</ol>
<p>Note: Occasionally a DKAN component will be moved to a new directory.
This should be explained in the release notes for that version. But if
you get errors related to incorrect location of module files, you may
want to try <a class="reference external" href="https://www.drupal.org/project/registry_rebuild">rebuilding the
registry</a>.</p>
</div>
<div class="section" id="using-drush-make">
<h3>Using drush make<a class="headerlink" href="#using-drush-make" title="Permalink to this headline">¶</a></h3>
<p>We are developing an easier workflow to update DKAN on the command line.
For the time being, the recommended method for updating using the
<code class="docutils literal"><span class="pre">drush</span> <span class="pre">make</span></code> instructions described in the Installation Instructions
is similar to the process described above.</p>
<p>Assuming you have followed the instructions for <code class="docutils literal"><span class="pre">drush</span> <span class="pre">make</span></code> and have
a <code class="docutils literal"><span class="pre">webroot</span></code> folder inside a main clone of the <a class="reference external" href="https://github.com/NuCivic/dkan">DKAN
repo</a>:</p>
<ol class="arabic simple">
<li>Back up your database</li>
<li>Copy your <code class="docutils literal"><span class="pre">sites</span></code> folder somewhere safe.</li>
<li>Remove your webroot folder: <code class="docutils literal"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">webroot</span></code> (use with caution!)</li>
<li>Check out the new version of DKAN you want to update to:
<code class="docutils literal"><span class="pre">git</span> <span class="pre">checkout</span> <span class="pre">tags/7.x-1.12</span></code></li>
<li><code class="docutils literal"><span class="pre">drush</span> <span class="pre">make</span> <span class="pre">drupal-org-core.make</span> <span class="pre">webroot</span> <span class="pre">--yes</span></code></li>
<li><code class="docutils literal"><span class="pre">rsync</span> <span class="pre">-av</span> <span class="pre">.</span> <span class="pre">webroot/profiles/dkan</span> <span class="pre">--exclude</span> <span class="pre">webroot</span></code></li>
<li><code class="docutils literal"><span class="pre">drush</span> <span class="pre">make</span> <span class="pre">--no-core</span> <span class="pre">--contrib-destination=./</span> <span class="pre">drupal-org.make</span> <span class="pre">webroot/profiles/dkan</span> <span class="pre">--no-recursion</span> <span class="pre">--yes</span></code></li>
<li>Replace the <code class="docutils literal"><span class="pre">sites</span></code> folder in your new codebase with your old
<code class="docutils literal"><span class="pre">sites</span></code> folder.</li>
<li>Check the new versions&#8217; <a class="reference external" href="https://github.com/NuCivic/dkan/releases">release
notes</a> to see if there
are any special instructions for updating. (If you are several
releases behind, you may need to follow instructions for several
releases).</li>
<li><code class="docutils literal"><span class="pre">drush</span> <span class="pre">updatedb</span></code>.</li>
<li><code class="docutils literal"><span class="pre">drush</span> <span class="pre">cache-clear</span> <span class="pre">all</span></code></li>
<li><code class="docutils literal"><span class="pre">drush</span> <span class="pre">features-revert-all</span></code> (use with caution).</li>
</ol>
<p>You can also use this method to upgrade to the most recent
&#8220;bleeding-edge&#8221; development version of DKAN. Instead of checking out a
specific tag, check out the <code class="docutils literal"><span class="pre">7.x-1.x</span></code> branch in step 3.</p>
</div>
</div>
<div class="section" id="features-module">
<h2>Features Module<a class="headerlink" href="#features-module" title="Permalink to this headline">¶</a></h2>
<p>DKAN packages much of its configuration using the <a class="reference external" href="https://www.drupal.org/project/features">Features
module</a>.</p>
<p>After DKAN is upgraded DKAN site maintainers may wish to revert some
features in order to take advantage of new functionality. We recommend
using the <a class="reference external" href="https://www.drupal.org/project/features_override">Features
Override</a> module to
capture overridden features elements to make it easier to revert
Features from DKAN when desired. More documentation on this to come.</p>
</div>
<div class="section" id="advanced-workflows">
<h2>Advanced Workflows<a class="headerlink" href="#advanced-workflows" title="Permalink to this headline">¶</a></h2>
<div class="section" id="using-a-custom-make-file">
<h3>Using a Custom Make file<a class="headerlink" href="#using-a-custom-make-file" title="Permalink to this headline">¶</a></h3>
<p>DKAN is “built” using a make file and <code class="docutils literal"><span class="pre">drush</span> <span class="pre">make</span></code>. The
<a class="reference external" href="https://github.com/NuCivic/dkan/blob/7.x-1.x/drupal-org.make">drupal-org.make</a>
file in DKAN contains a list of most of the modules installed in DKAN.</p>
<p>When developing a website for production, it is recommended to keep a
make file for all custom modules added to DKAN. Instead of using
<code class="docutils literal"><span class="pre">drush</span> <span class="pre">pm-download</span></code> or other means of downloading and adding modules
to <code class="docutils literal"><span class="pre">sites/all</span></code>, a make file is kept that has a list of the sites
modules. This enforces some best practices about not overwriting
contributed modules, maintaining patches, and reusability. This make
file along with DKAN’s makefiles also provide a reusable recipe for your
site.</p>
<p>More documentation and automation scripts regarding this process are
under active development and can be viewed here: <a class="reference external" href="http://dkan-starter.readthedocs.io/">DKAN Starter Documentation</a>.</p>
</div>
<div class="section" id="adding-additional-modules-or-features">
<h3>Adding additional modules or features<a class="headerlink" href="#adding-additional-modules-or-features" title="Permalink to this headline">¶</a></h3>
<p>New modules, themes, or libraries should be added to the &#8216;sites/all&#8217;
directory. For modules or themes it is often useful to differentiate
&#8220;custom&#8221; modules from &#8220;community&#8221; modules. We often have a directory
structure for modules like:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Location</th>
<th class="head">Contents</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">sites/all/modules/contrib</span></code></td>
<td>community or contributed modules</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">sites/all/modules/custom</span></code></td>
<td>custom modules</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">sites/all/libraries</span></code></td>
<td>Additional libraries</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="overriding-current-dkan-modules-or-functionality">
<h3>Overriding current DKAN modules or functionality<a class="headerlink" href="#overriding-current-dkan-modules-or-functionality" title="Permalink to this headline">¶</a></h3>
<p>Drupal has an inheritance model that makes it easy to override modules
added to distributions as well as the functionality of other modules.</p>
<p>Any modules or themes added to <code class="docutils literal"><span class="pre">sites/all</span></code> will override the same
named module as one that is placed in <code class="docutils literal"><span class="pre">profiles/dkan/</span></code>.</p>
<p>If a DKAN site maintainer wishes to update a module supplied by DKAN
that module can be placed in “sites/all”. For example if one wished to
update the <a class="reference external" href="https://www.drupal.org/project/date">Date module</a>, if
there is a security update or new release with a certain functionality,
add it to <code class="docutils literal"><span class="pre">sites/all</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Location</th>
<th class="head">Version</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">profiles/dkan/modules/contrib/date</span></code></td>
<td>7.x-1.4</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">sites/all/modules/contrib/date</span></code></td>
<td>7.x-1.5</td>
</tr>
</tbody>
</table>
<p>In this case, DKAN will use the version 7.x-1.5 and ignore 7.x-1.4.</p>
<p>If, later, you update your site to a version of DKAN that uses Date v.
7.x-1.5, the version in <code class="docutils literal"><span class="pre">sites/all</span></code> should be removed. Be careful to
review your overrides in <code class="docutils literal"><span class="pre">sites/all</span></code> after every DKAN update to ensure
you are not missing important module updates.</p>
<p>Note that moving to a different location for an existing, installed
module will require a <a class="reference external" href="https://www.drupal.org/project/registry_rebuild">Registry
Rebuild</a> to prompt
Drupal to refresh all module paths.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../components/index.html" class="btn btn-neutral float-right" title="Major Components" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.13',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>